{% extends 'base.html.twig' %}
{% import 'macros/list_macros.html.twig' as macros %}

{% block body %}
<div class="container mt-4">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ path('app_home') }}">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">{{ list.title }}</li>
      </ol>
    </nav>

    <h1>
        {{ list.title }}
        {% if list.releaseYear %}
            <span class="text-muted fs-4">({{ list.releaseYear }})</span>
        {% endif %}
    </h1>
    
    <div class="mb-3">
        {% if list.code %}
            <span class="badge bg-light text-dark border">{{ list.code }}</span>
        {% endif %}
        {% if list.magazine %}
            <a href="{{ path('app_magazine_show', list.magazine.routeParams) }}" class="badge bg-secondary text-decoration-none">{{ list.magazine.name }}</a>
        {% endif %}
        {% if list.critic %}
            <a href="{{ path('app_critic_show', list.critic.routeParams) }}" class="badge bg-info text-decoration-none">{{ list.critic.name }}</a>
        {% endif %}
        {% if list.genre %}
            <span class="badge bg-success">{{ list.genre.name }}</span>
        {% endif %}
        {% if list.type == 'aggregate' %}
            <span class="badge bg-primary">Verzamelijst</span>
        {% endif %}
    </div>

    {% if list.aggregatedIn|length > 0 %}
    <div class="alert alert-info" role="alert">
        Deze lijst is onderdeel van:
        {% for parentList in list.aggregatedIn %}
            <a href="{{ path('app_list_show', parentList.routeParams) }}" class="alert-link">{{ parentList.title }}</a>{% if not loop.last %}, {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    {% if list.description %}
        <p class="lead">{{ list.description }}</p>
    {% endif %}
    
    <hr>
    
    {% if list.sources|length > 0 %}
    <div class="mb-4">
        <h3>
            <button class="btn btn-link text-decoration-none p-0 text-dark" type="button" data-bs-toggle="collapse" data-bs-target="#sourcesCollapse" aria-expanded="false" aria-controls="sourcesCollapse">
                Bronnen / Bijdragers ▾
            </button>
        </h3>
        <div class="collapse" id="sourcesCollapse">
            <div class="list-group mt-2">
            {% for source in list.sources %}
                {{ macros.list_card(source, album_cover_base_url) }}
            {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    {% if computedItems|length > 0 %}
    <h3>Albums in lijst</h3>
    <table class="table table-striped mb-5 align-middle">
        <thead>
            <tr>
                <th></th>
                <th>
                    <a href="{{ path('app_list_show', list.routeParams|merge({sort: 'position', direction: (currentSort == 'position' and currentDirection == 'desc' ? 'asc' : 'desc')})) }}">
                        Score
                        {% if currentSort == 'position' %}
                            {{ currentDirection == 'asc' ? '▲' : '▼' }}
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="{{ path('app_list_show', list.routeParams|merge({sort: 'artist', direction: (currentSort == 'artist' and currentDirection == 'asc' ? 'desc' : 'asc')})) }}">
                        Artiest
                        {% if currentSort == 'artist' %}
                            {{ currentDirection == 'asc' ? '▲' : '▼' }}
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="{{ path('app_list_show', list.routeParams|merge({sort: 'album', direction: (currentSort == 'album' and currentDirection == 'asc' ? 'desc' : 'asc')})) }}">
                        Album
                        {% if currentSort == 'album' %}
                            {{ currentDirection == 'asc' ? '▲' : '▼' }}
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="{{ path('app_list_show', list.routeParams|merge({sort: 'year', direction: (currentSort == 'year' and currentDirection == 'asc' ? 'desc' : 'asc')})) }}">
                        Jaar
                        {% if currentSort == 'year' %}
                            {{ currentDirection == 'asc' ? '▲' : '▼' }}
                        {% endif %}
                    </a>
                </th>
            </tr>
        </thead>
        <tbody>
        {% for item in computedItems %}
            <tr>
                <td style="width: 50px;">
                    {% if item.album.imageUrl %}
                        <img src="{{ album_cover_base_url ~ item.album.imageUrl }}" alt="{{ item.album.title }}" class="img-fluid rounded" style="width: 40px; height: 40px; object-fit: cover;">
                    {% else %}
                        <div class="bg-light border rounded d-flex align-items-center justify-content-center text-muted" style="width: 40px; height: 40px;">
                            <small style="font-size: 0.5rem;">No Img</small>
                        </div>
                    {% endif %}
                </td>
                <td>{{ item.score }}</td>
                <td><a href="{{ path('app_artist_show', item.album.artist.routeParams) }}">{{ item.album.artist.name }}</a></td>
                <td><a href="{{ path('app_album_show', item.album.routeParams) }}">{{ item.album.title }}</a></td>
                <td>{{ item.album.releaseYear }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endif %}

    {% if list.type != 'aggregate' %}
    <h3>Albums in lijst</h3>
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                <th></th>
                {# Show mentions column first if list has mentions #}
                {% if hasMentions %}
                    <th>
                        <a href="{{ path('app_list_show', list.routeParams|merge({sort: 'position', direction: (currentSort == 'position' and currentDirection == 'desc' ? 'asc' : 'desc')})) }}">
                            Vermeldingen
                            {% if currentSort == 'position' %}
                                {{ currentDirection == 'asc' ? '▲' : '▼' }}
                            {% endif %}
                        </a>
                    </th>
                {% elseif list.type == 'ordered' %}
                    {# Show position column first for ordered lists without mentions #}
                    <th>
                        <a href="{{ path('app_list_show', list.routeParams|merge({sort: 'position', direction: (currentSort == 'position' and currentDirection == 'asc' ? 'desc' : 'asc')})) }}">
                            Pos
                            {% if currentSort == 'position' %}
                                {{ currentDirection == 'asc' ? '▲' : '▼' }}
                            {% endif %}
                        </a>
                    </th>
                {% endif %}
                <th>
                    <a href="{{ path('app_list_show', list.routeParams|merge({sort: 'artist', direction: (currentSort == 'artist' and currentDirection == 'asc' ? 'desc' : 'asc')})) }}">
                        Artiest
                        {% if currentSort == 'artist' %}
                            {{ currentDirection == 'asc' ? '▲' : '▼' }}
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="{{ path('app_list_show', list.routeParams|merge({sort: 'album', direction: (currentSort == 'album' and currentDirection == 'asc' ? 'desc' : 'asc')})) }}">
                        Album
                        {% if currentSort == 'album' %}
                            {{ currentDirection == 'asc' ? '▲' : '▼' }}
                        {% endif %}
                    </a>
                </th>
                <th>
                    <a href="{{ path('app_list_show', list.routeParams|merge({sort: 'year', direction: (currentSort == 'year' and currentDirection == 'asc' ? 'desc' : 'asc')})) }}">
                        Jaar
                        {% if currentSort == 'year' %}
                            {{ currentDirection == 'asc' ? '▲' : '▼' }}
                        {% endif %}
                    </a>
                </th>
            </tr>
        </thead>
        <tbody>
        {% for item in items %}
            <tr>
                <td style="width: 50px;">
                    {% if item.album.imageUrl %}
                        <img src="{{ album_cover_base_url ~ item.album.imageUrl }}" alt="{{ item.album.title }}" class="img-fluid rounded" style="width: 40px; height: 40px; object-fit: cover;">
                    {% else %}
                        <div class="bg-light border rounded d-flex align-items-center justify-content-center text-muted" style="width: 40px; height: 40px;">
                            <small style="font-size: 0.5rem;">No Img</small>
                        </div>
                    {% endif %}
                </td>
                {% if hasMentions %}
                    <td>{{ item.mentions }}</td>
                {% elseif list.type == 'ordered' %}
                    <td>{{ item.position }}</td>
                {% endif %}
                <td><a href="{{ path('app_artist_show', item.album.artist.routeParams) }}">{{ item.album.artist.name }}</a></td>
                <td><a href="{{ path('app_album_show', item.album.routeParams) }}">{{ item.album.title }}</a></td>
                <td>{{ item.album.releaseYear }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endif %}
</div>
{% endblock %}

